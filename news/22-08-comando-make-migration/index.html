<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="Il comando di Laravel per creare le migrazioni nasconde dei trucchetti interessanti.">

    <meta property="og:site_name" content="Italian Laravel News" />
    <meta property="og:title" content="I segreti del comando make:migration | Italian Laravel News" />
    <meta property="og:locale" content="it_IT" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://laravel-news.it/news/22-08-comando-make-migration" />
    <meta property="og:description" content="Il comando di Laravel per creare le migrazioni nasconde dei trucchetti interessanti." />

        <meta property="og:image" content="/assets/articles/22-08-comando-make-migration.png" />
    <meta name="twitter:image" content="/assets/articles/22-08-comando-make-migration.png" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="I segreti del comando make:migration | Italian Laravel News" />
    <meta name="twitter:description" content="Il comando di Laravel per creare le migrazioni nasconde dei trucchetti interessanti." />

    <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
    <link rel="manifest" href="/assets/icons/manifest.json">
    <meta name="msapplication-TileColor" content="#F48220">
    <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#F48220" />

    <title>I segreti del comando make:migration | Italian Laravel News</title>

    <link rel="home" href="https://laravel-news.it">
    <link rel="icon" href="/favicon.ico">
    <link href="/news/feed.atom" type="application/atom+xml" rel="alternate" title="Italian Laravel News Atom Feed">

        <script type="text/javascript">
        (function(f, b) {
            if (!b.__SV) {
                var e, g, i, h;
                window.mixpanel = b;
                b._i = [];
                b.init = function(e, f, c) {
                    function g(a, d) {
                        var b = d.split(".");
                        2 == b.length && (a = a[b[0]], d = b[1]);
                        a[d] = function() {
                            a.push([d].concat(Array.prototype.slice.call(arguments, 0)))
                        }
                    }
                    var a = b;
                    "undefined" !== typeof c ? a = b[c] = [] : c = "mixpanel";
                    a.people = a.people || [];
                    a.toString = function(a) {
                        var d = "mixpanel";
                        "mixpanel" !== c && (d += "." + c);
                        a || (d += " (stub)");
                        return d
                    };
                    a.people.toString = function() {
                        return a.toString(1) + ".people (stub)"
                    };
                    i = "disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
                    for (h = 0; h < i.length; h++) g(a, i[h]);
                    var j = "set set_once union unset remove delete".split(" ");
                    a.get_group = function() {
                        function b(c) {
                            d[c] = function() {
                                call2_args = arguments;
                                call2 = [c].concat(Array.prototype.slice.call(call2_args, 0));
                                a.push([e, call2])
                            }
                        }
                        for (var d = {}, e = ["get_group"].concat(Array.prototype.slice.call(arguments, 0)), c = 0; c < j.length; c++) b(j[c]);
                        return d
                    };
                    b._i.push([e, f, c])
                };
                b.__SV = 1.2;
                e = f.createElement("script");
                e.type = "text/javascript";
                e.async = !0;
                e.src = "undefined" !== typeof MIXPANEL_CUSTOM_LIB_URL ?
                    MIXPANEL_CUSTOM_LIB_URL : "file:" === f.location.protocol && "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//) ? "https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js" : "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";
                g = f.getElementsByTagName("script")[0];
                g.parentNode.insertBefore(e, g)
            }
        })(document, window.mixpanel || []);

        // Enabling the debug mode flag is useful during implementation,
        // but it's recommended you remove it for production
        mixpanel.init('066588ba07824828cd3becc145c0ddd7', {
            debug: true
        });
        mixpanel.track('Sign up');
    </script>
    <script type="text/javascript">
        var _iub = _iub || [];
        _iub.csConfiguration = {
            "ccpaAcknowledgeOnDisplay": true,
            "ccpaApplies": true,
            "consentOnContinuedBrowsing": false,
            "enableCcpa": true,
            "floatingPreferencesButtonDisplay": "bottom-right",
            "invalidateConsentWithoutLog": true,
            "perPurposeConsent": true,
            "siteId": 2680106,
            "whitelabel": false,
            "cookiePolicyId": 89440925,
            "lang": "it",
            "cookiePolicyUrl": "https://www.iubenda.com/privacy-policy/14174587/cookie-policy",
            "privacyPolicyUrl": "https://www.iubenda.com/privacy-policy/89440925/legal",
            "banner": {
                "acceptButtonDisplay": true,
                "closeButtonDisplay": false,
                "customizeButtonDisplay": true,
                "explicitWithdrawal": true,
                "listPurposes": true,
                "position": "float-top-center",
                "rejectButtonDisplay": true
            }
        };
    </script>
    <script type="text/javascript" src="//cdn.iubenda.com/cs/ccpa/stub.js"></script>
    <script type="text/javascript" src="//cdn.iubenda.com/cs/iubenda_cs.js" charset="UTF-8" async></script>
    
    <link rel="stylesheet" href="/assets/build/css/main.css?id=e1de9b0215effd6f6543a6fbab177e39">
</head>

<body class="flex flex-col justify-between min-h-screen bg-DirtyWhite text-gray-800 leading-normal font-sans">
    <header class="flex items-center shadow bg-DarkBlue border-b h-24 py-4" role="banner">
        <div class="container flex items-center max-w-4xl mx-auto px-4 lg:px-8">
            <div class="flex items-center">
                <a href="/" title="Italian Laravel News home" class="inline-flex items-center">
                    <div class="p-2 rounded bg-white">
                        <img class="h-6 md:h-10" src="/assets/images/logo-full.png" alt="Italian Laravel News logo" />
                    </div>
                </a>
            </div>

            <div id="vue-search" class="flex flex-1 justify-end items-center bg-DarkBlue">
                <!-- <search></search> -->

                <nav class="hidden lg:flex items-center justify-end text-lg">
    <a title="Italian Laravel News News" href="/news"
        class="ml-6 text-Teal hover:text-Lime ">
        { News }
    </a>

    <a title="Italian Laravel News Community" href="/communities"
        class="ml-6 text-Teal hover:text-Lime ">
        { Community }
    </a>
</nav>

                <button class="flex justify-center items-center bg-Teal h-10 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

            </div>
        </div>
    </header>

    <nav id="js-nav-menu" class="w-auto px-2 pt-6 pb-2 bg-gray-200 shadow hidden lg:hidden">
    <ul class="my-0">
        <li class="pl-4">
            <a
                title="Italian Laravel News News"
                href="/news"
                class="block mt-0 mb-4 text-sm no-underline text-gray-800 hover:text-blue-500"
            >News</a>
        </li>
        <li class="pl-4">
            <a
                title="Italian Laravel News Community"
                href="/communities"
                class="block mt-0 mb-4 text-sm no-underline text-gray-800 hover:text-blue-500"
            >Community</a>
        </li>
    </ul>
</nav>

    <main role="main" class="flex-auto w-full container max-w-4xl mx-auto py-8 px-6">
        
<div>
            <img src="/assets/articles/22-08-comando-make-migration.png" alt="I segreti del comando make:migration cover image" class="mb-2 rounded-lg shadow-lg overflow-hidden">
    
    <h1 class="leading-none mb-2">I segreti del comando make:migration</h1>

    <p class="text-gray-700 md:mt-0">Alberto Peripolli  •  25 agosto 2022</p>

    <hr class="border-b my-4">

    <div class="mb-4 text-right">
                        <a
                href="/news/categories/tips"
                title="View posts in tips"
                class="inline-block bg-Teal hover:bg-DarkBlue hover:text-white leading-loose tracking-wide text-white uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >tips</a>
                </div>

    <div class="border-b border-blue-200 mb-10 pb-4" v-pre>
        <p>Una delle operazioni più comuni in Laravel è la creazione delle migrazioni, esse ci consentono semplicemente di cambiare 
stato al nostro database.<br />
Il metodo più consono per creare una nuova migrazione è attraverso relativo comando artisan make, al quale la 
<a href="https://laravel.com/docs/9.x/migrations#generating-migrations">documentazione ufficiale</a> limita un solo paragrafo, 
pochi però sanno che nascosti nel comando base ci sono molti trucchetti che possono semplificare e velocizzare queste operazioni.</p>

<!-- more -->

<p>Il comando artisan esposto nella documentazione è il seguente:</p>

<pre><code class="language-bash">php artisan make:migration create_flights_table
</code></pre>

<p>La guida dice che esso cercherà nel nome passato i riferimenti alla tabella e se si tratta di una creazione, ma non spiega il come.</p>

<p>Per questo ho creato questa semplice guida che riepiloga tutti i trucchi.</p>

<h2>1. Passare il nome senza usare i _</h2>

<p>Nell'esempio sopra riportato il nome del file è scritto con tutti i trattini bassi che dividono le parole, ma non è molto pratico da scrivere.<br />
Per fortuna è possibile passare il nome dentro a degli apici "" utilizzando così i più comodi spazi:</p>

<pre><code class="language-bash">php artisan make:migration "create flights table"
</code></pre>

<h2>2. Creare una nuova tabella</h2>

<p>Per creare una nuova tabella dobbiamo far capire al comando che si tratta di una creazione e il nome della tabella.<br />
Possiamo quindi usare un nome specifico per la migrazione o passare opzioni aggiuntive <code>–create[=CREATE]</code> e/o <code>–table[=TABLE]</code>. 
Il comando tenterà di scoprire tali informazioni dal nome tramite un componente chiamato <code>TableGuesser</code>.</p>

<pre><code class="language-bash"># utilizzando semplicemente il TableGuesser
php artisan make:migration "create users table"

# con i parametri --table e --create
php artisan make:migration "My migration" --table=users --create

# oppure più semplicemente
php artisan make:migration "My migration" --create=users
</code></pre>

<p>Per far capire al <code>TableGuesser</code> che vogliamo creare una nuova tabella basta mettere nel nome "<strong>create</strong> nome_tabella <strong>table</strong>" oppure solamente "<strong>create</strong> nome_tabella".</p>

<p>Una volta lanciato il comando verrà creata una nuova migration con il nome <code>date_time_[nome_della_migrazione].php</code> con precompilato il codice per la creazione della tabella:</p>

<pre><code class="language-php">public function up()
{
    Schema::create('my_table', function (Blueprint $table) {
        $table-&gt;id();
        $table-&gt;timestamps();
    });
}

public function down()
{
    Schema::dropIfExists('my_table');
}
</code></pre>

<h2>3. Modificare una tabella esistente</h2>

<p>Similmente al comando per creare la tabella anche per modificare una tabella esistente abbiamo due modi per farlo capire il nome della tabella.
Anche in questo caso possiamo utilizzare un nome interpretabile dal <code>TableGuesser</code> o specificarlo con l'opzione <code>--table[=TABLE]</code>.</p>

<pre><code class="language-bash"># utilizzando semplicemente il TableGuesser
php artisan make:migration "add field to users"
php artisan make:migration remove_field_from_users_table

# con l'opzione --table
php artisan make:migration "My migration" --table=my_table
</code></pre>

<p>Per far capire al <code>TableGuesser</code> il nome della tabella ci basta scriverlo alla fine del nome e anteporlo alle preposizioni <code>to</code>, <code>from</code> o <code>in</code>.</p>

<p>Una volta lanciato il comando verrà creata una nuova migration con il nome <code>date_time_[nome_della_migrazione].php</code> con precompilato il codice per la modifica della tabella:</p>

<pre><code class="language-php">public function up()
{
    Schema::table('my_table', function (Blueprint $table) {
        //
    });
}

public function down()
{
    Schema::table('my_table', function (Blueprint $table) {
        //
    });
}
</code></pre>

<h2>4. Personalizzazione dei path</h2>

<p>Di default tutte le migrazioni verranno create nella cartella <code>database/migrations</code>, ma in molti casi (ad esempio nella DDD) potremmo essere interessati a cambiare questo percorso.</p>

<p>Per far questo possiamo usare l'opzione <code>--path[=PATH]</code>, nella quale definiamo il percorso alternativo dove creare la migrazione.<br />
Inoltre se aggiungiamo l'opzione <code>--realpath</code> il path passato al comando sarà un path assoluto (utilizzando il path base di Laravel).</p>

<pre><code class="language-bash">php artisan make:migration my_migration --path=test/folder
# Crea la migrazione in ./test/folder/date_time_my_migration.php

php artisan make:migration my_migration --path=test/folder
# Crea la migrazione in /var/www/laravel-project/test/folder/date_time_my_migration.php se laravel è nella cartella /var/www/laravel-project
</code></pre>

<p>Per completezza segnalo anche che se viene passata l'opzione <code>--fullpath</code> nel messaggio del comando artisan verrà aggiunto il path al nome.</p>

<pre><code class="language-bash"> INFO  Created migration [test/folder/2022_08_31_085751_my_migration.php]. 
</code></pre>

<h2>5. Personalizzazione degli stub</h2>

<p>Molte volte il codice di base che ci propone Laravel ci va un po' stretto... per fortuna possiamo personalizzarlo semplicemente.</p>

<p>Ci basta lanciare il comando artisan:</p>

<pre><code class="language-bash">php artisan stub:publish
</code></pre>

<p>e verranno pubblicati nella cartella <code>stubs</code> nella root del progetto tutte le basi di partenza per la creazione di file dai comandi make di Laravel artisan.
Una volta modificati verranno utilizzate queste nuove versioni dai comandi.</p>

<p>I file interessanti per le migrazioni sono:</p>

<ul>
<li><code>migration.stub</code> file vuoto:utilizzato quando il comando con capisce la tabella</li>
<li><code>migration.create.stub</code> file per la creazione di una tabella</li>
<li><code>migration.update.stub</code> file per la modifica di una tabella</li>
</ul>

<p>TIP: Se siete a corto di idee potete utilizzare il <a href="https://github.com/spatie/laravel-stubs">pacchetto di spatie <code>spatie/laravel-stubs</code></a>, che contiene le personalizzazioni opinionate degli stub di Laravel. 
In questo caso ad esempio hanno completamente rimosso le funzioni di rollback delle migrazioni.</p>

<h2>6. Creazione del modello insieme alla migrazione</h2>

<p>Nel caso volessimo creare anche un nuovo Model insieme alla migrazione, possiamo ricorrere al comando artisan <code>make:model</code>.</p>

<p>Questo comando crea un nuovo Model ma passando l'opzione <code>-m</code> o <code>--migration</code> crea anche la migrazione di creazione tabella.</p>

<pre><code class="language-bash">php artisan make:model Flight --migration
# questo comando creerà il model in app/Models/Flight.php 
# ed anche la migrazione in database/migrations/date_time_create_flights_table.php
</code></pre>
    </div>

    <nav class="flex justify-between text-sm md:text-base">
        <div>
                            <a href="https://laravel-news.it/news/22-07-inizializzazione-proibita" title="Older Post: L&#039;inizializzazione proibita">
                    &LeftArrow; L&#039;inizializzazione proibita
                </a>
                    </div>

        <div>
                            <a href="https://laravel-news.it/news/22-09-laracon-2022" title="Newer Post: Laracon 2022">
                    Laracon 2022 &RightArrow;
                </a>
                    </div>
    </nav>

    <hr class="border-b my-4"/>

    <h4 class="text-center">Commenti e valutazioni</h4>

    <div id="disqus_thread"></div>
    </main>

    <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">

        <ul class="flex flex-col md:flex-row justify-center list-disc">
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/configuration">Configuration</a>
            </li>
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/contents">Contenuti</a>
            </li>
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/devops">Devops</a>
            </li>
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/events">Eventi</a>
            </li>
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/news">News</a>
            </li>
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/packages">Pacchetti</a>
            </li>
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/php">PHP</a>
            </li>
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/tips">Tips</a>
            </li>
                        <li class="md:mr-6">
                <a href="https://laravel-news.it/news/categories/tutorials">Tutorial</a>
            </li>
                    </ul>

        <ul class="flex flex-col md:flex-row justify-center list-none">
            <li class="md:mr-2">
                &copy; <a href="/copyright" title="Copyright">Laravel News Italia</a> 2022.
            </li>

            <li>
                Trattamento dei dati e <a target="_blank" href="https://www.iubenda.com/privacy-policy/89440925/legal" title="Jigsaw by Tighten">Privacy</a>
            </li>
        </ul>
    </footer>

    <script src="/assets/build/js/main.js?id=70344500d5f59b465fe2496606f75007"></script>
    <script>
        var disqus_config = function () {
        this.page.url = 'https://laravel-news.it/news/22-08-comando-make-migration';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '22-08-comando-make-migration'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };
        
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://laravel-news-it.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    </script>
    <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
</body>

</html>